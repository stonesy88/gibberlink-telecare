{"version":3,"file":"index.esm.js","sources":["../src/utils.ts","../src/openai/index.ts","../src/openai/azure.ts","../src/vercel/middleware.ts","../src/anthropic/index.ts","../../node_modules/decamelize/index.js","../../node_modules/camelcase/index.js","../../node_modules/@langchain/core/dist/load/map_keys.js","../../node_modules/@langchain/core/dist/load/serializable.js","../../node_modules/@langchain/core/dist/utils/env.js","../../node_modules/@langchain/core/dist/callbacks/base.js","../src/langchain/callbacks.ts"],"sourcesContent":["import { PostHog } from 'posthog-node'\nimport OpenAIOrignal from 'openai'\nimport AnthropicOriginal from '@anthropic-ai/sdk'\n\ntype ChatCompletionCreateParamsBase = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParams\ntype MessageCreateParams = AnthropicOriginal.Messages.MessageCreateParams\n\nexport interface MonitoringParams {\n  posthogDistinctId?: string\n  posthogTraceId?: string\n  posthogProperties?: Record<string, any>\n  posthogPrivacyMode?: boolean\n  posthogGroups?: Record<string, any>\n  posthogModelOverride?: string\n  posthogProviderOverride?: string\n  posthogCostOverride?: CostOverride\n}\n\nexport interface CostOverride {\n  inputCost: number\n  outputCost: number\n}\n\nexport const getModelParams = (\n  params: ((ChatCompletionCreateParamsBase | MessageCreateParams) & MonitoringParams) | null\n): Record<string, any> => {\n  if (!params) {\n    return {}\n  }\n  const modelParams: Record<string, any> = {}\n  const paramKeys = [\n    'temperature',\n    'max_tokens',\n    'max_completion_tokens',\n    'top_p',\n    'frequency_penalty',\n    'presence_penalty',\n    'n',\n    'stop',\n    'stream',\n    'streaming',\n  ] as const\n\n  for (const key of paramKeys) {\n    if (key in params && (params as any)[key] !== undefined) {\n      modelParams[key] = (params as any)[key]\n    }\n  }\n  return modelParams\n}\n\n/**\n * Helper to format responses (non-streaming) for consumption, mirroring Python's openai vs. anthropic approach.\n */\nexport const formatResponse = (response: any, provider: string): Array<{ role: string; content: string }> => {\n  if (!response) {\n    return []\n  }\n  if (provider === 'anthropic') {\n    return formatResponseAnthropic(response)\n  } else if (provider === 'openai') {\n    return formatResponseOpenAI(response)\n  }\n  return []\n}\n\nexport const formatResponseAnthropic = (response: any): Array<{ role: string; content: string }> => {\n  // Example approach if \"response.content\" holds array of text segments, etc.\n  const output: Array<{ role: string; content: string }> = []\n  for (const choice of response.content ?? []) {\n    if (choice?.text) {\n      output.push({\n        role: 'assistant',\n        content: choice.text,\n      })\n    }\n  }\n  return output\n}\n\nexport const formatResponseOpenAI = (response: any): Array<{ role: string; content: string }> => {\n  const output: Array<{ role: string; content: string }> = []\n  for (const choice of response.choices ?? []) {\n    if (choice.message?.content) {\n      output.push({\n        role: choice.message.role,\n        content: choice.message.content,\n      })\n    }\n  }\n  return output\n}\n\nexport const mergeSystemPrompt = (params: MessageCreateParams & MonitoringParams, provider: string): any => {\n  if (provider == 'anthropic') {\n    const messages = params.messages || []\n    if (!(params as any).system) {\n      return messages\n    }\n    const systemMessage = (params as any).system\n    return [{ role: 'system', content: systemMessage }, ...messages]\n  }\n  return params.messages\n}\n\nexport const withPrivacyMode = (client: PostHog, privacyMode: boolean, input: any): any => {\n  return (client as any).privacy_mode || privacyMode ? null : input\n}\n\nexport type SendEventToPosthogParams = {\n  client: PostHog\n  distinctId?: string\n  traceId: string\n  model: string\n  provider: string\n  input: any\n  output: any\n  latency: number\n  baseURL: string\n  httpStatus: number\n  usage?: { inputTokens?: number; outputTokens?: number }\n  params: (ChatCompletionCreateParamsBase | MessageCreateParams) & MonitoringParams\n  isError?: boolean\n  error?: string\n}\n\nexport const sendEventToPosthog = ({\n  client,\n  distinctId,\n  traceId,\n  model,\n  provider,\n  input,\n  output,\n  latency,\n  baseURL,\n  params,\n  httpStatus = 200,\n  usage = {},\n  isError = false,\n  error,\n}: SendEventToPosthogParams): void => {\n  if (client.capture) {\n    let errorData = {}\n    if (isError) {\n      errorData = {\n        $ai_is_error: true,\n        $ai_error: error,\n      }\n    }\n    let costOverrideData = {}\n    if (params.posthogCostOverride) {\n      const inputCostUSD = (params.posthogCostOverride.inputCost ?? 0) * (usage.inputTokens ?? 0)\n      const outputCostUSD = (params.posthogCostOverride.outputCost ?? 0) * (usage.outputTokens ?? 0)\n      costOverrideData = {\n        $ai_input_cost_usd: inputCostUSD,\n        $ai_output_cost_usd: outputCostUSD,\n        $ai_total_cost_usd: inputCostUSD + outputCostUSD,\n      }\n    }\n\n    client.capture({\n      distinctId: distinctId ?? traceId,\n      event: '$ai_generation',\n      properties: {\n        $ai_provider: params.posthogProviderOverride ?? provider,\n        $ai_model: params.posthogModelOverride ?? model,\n        $ai_model_parameters: getModelParams(params),\n        $ai_input: withPrivacyMode(client, params.posthogPrivacyMode ?? false, input),\n        $ai_output_choices: withPrivacyMode(client, params.posthogPrivacyMode ?? false, output),\n        $ai_http_status: httpStatus,\n        $ai_input_tokens: usage.inputTokens ?? 0,\n        $ai_output_tokens: usage.outputTokens ?? 0,\n        $ai_latency: latency,\n        $ai_trace_id: traceId,\n        $ai_base_url: baseURL,\n        ...params.posthogProperties,\n        ...(distinctId ? {} : { $process_person_profile: false }),\n        ...errorData,\n        ...costOverrideData,\n      },\n      groups: params.posthogGroups,\n    })\n  }\n}\n","import OpenAIOrignal from 'openai'\nimport { PostHog } from 'posthog-node'\nimport { v4 as uuidv4 } from 'uuid'\nimport { formatResponseOpenAI, MonitoringParams, sendEventToPosthog } from '../utils'\n\ntype ChatCompletion = OpenAIOrignal.ChatCompletion\ntype ChatCompletionChunk = OpenAIOrignal.ChatCompletionChunk\ntype ChatCompletionCreateParamsBase = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParams\ntype ChatCompletionCreateParamsNonStreaming = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParamsNonStreaming\ntype ChatCompletionCreateParamsStreaming = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParamsStreaming\nimport type { APIPromise, RequestOptions } from 'openai/core'\nimport type { Stream } from 'openai/streaming'\n\ninterface MonitoringOpenAIConfig {\n  apiKey: string\n  posthog: PostHog\n  baseURL?: string\n}\n\nexport class PostHogOpenAI extends OpenAIOrignal {\n  private readonly phClient: PostHog\n  public chat: WrappedChat\n\n  constructor(config: MonitoringOpenAIConfig) {\n    const { posthog, ...openAIConfig } = config\n    super(openAIConfig)\n    this.phClient = posthog\n    this.chat = new WrappedChat(this, this.phClient)\n  }\n}\n\nexport class WrappedChat extends OpenAIOrignal.Chat {\n  constructor(parentClient: PostHogOpenAI, phClient: PostHog) {\n    super(parentClient)\n    this.completions = new WrappedCompletions(parentClient, phClient)\n  }\n\n  public completions: WrappedCompletions\n}\n\nexport class WrappedCompletions extends OpenAIOrignal.Chat.Completions {\n  private readonly phClient: PostHog\n\n  constructor(client: OpenAIOrignal, phClient: PostHog) {\n    super(client)\n    this.phClient = phClient\n  }\n\n  // --- Overload #1: Non-streaming\n  public create(\n    body: ChatCompletionCreateParamsNonStreaming & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion>\n\n  // --- Overload #2: Streaming\n  public create(\n    body: ChatCompletionCreateParamsStreaming & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<Stream<ChatCompletionChunk>>\n\n  // --- Overload #3: Generic base\n  public create(\n    body: ChatCompletionCreateParamsBase & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion | Stream<ChatCompletionChunk>>\n\n  // --- Implementation Signature\n  public create(\n    body: ChatCompletionCreateParamsBase & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion | Stream<ChatCompletionChunk>> {\n    const {\n      posthogDistinctId,\n      posthogTraceId,\n      posthogProperties,\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      posthogPrivacyMode = false,\n      posthogGroups,\n      ...openAIParams\n    } = body\n\n    const traceId = posthogTraceId ?? uuidv4()\n    const startTime = Date.now()\n\n    const parentPromise = super.create(openAIParams, options)\n\n    if (openAIParams.stream) {\n      return parentPromise.then((value) => {\n        if ('tee' in value) {\n          const [stream1, stream2] = value.tee()\n          // Use one stream for tracking\n          ;(async () => {\n            try {\n              let accumulatedContent = ''\n              let usage = { inputTokens: 0, outputTokens: 0 }\n\n              for await (const chunk of stream1) {\n                const delta = chunk?.choices?.[0]?.delta?.content ?? ''\n                accumulatedContent += delta\n                if (chunk.usage) {\n                  usage = {\n                    inputTokens: chunk.usage.prompt_tokens ?? 0,\n                    outputTokens: chunk.usage.completion_tokens ?? 0,\n                  }\n                }\n              }\n\n              const latency = (Date.now() - startTime) / 1000\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model: openAIParams.model,\n                provider: 'openai',\n                input: openAIParams.messages,\n                output: [{ content: accumulatedContent, role: 'assistant' }],\n                latency,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: 200,\n                usage,\n              })\n            } catch (error: any) {\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model: openAIParams.model,\n                provider: 'openai',\n                input: openAIParams.messages,\n                output: [],\n                latency: 0,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: error?.status ? error.status : 500,\n                usage: { inputTokens: 0, outputTokens: 0 },\n                isError: true,\n                error: JSON.stringify(error),\n              })\n            }\n          })()\n\n          // Return the other stream to the user\n          return stream2\n        }\n        return value\n      }) as APIPromise<Stream<ChatCompletionChunk>>\n    } else {\n      const wrappedPromise = parentPromise.then(\n        (result) => {\n          if ('choices' in result) {\n            const latency = (Date.now() - startTime) / 1000\n            sendEventToPosthog({\n              client: this.phClient,\n              distinctId: posthogDistinctId ?? traceId,\n              traceId,\n              model: openAIParams.model,\n              provider: 'openai',\n              input: openAIParams.messages,\n              output: formatResponseOpenAI(result),\n              latency,\n              baseURL: (this as any).baseURL ?? '',\n              params: body,\n              httpStatus: 200,\n              usage: {\n                inputTokens: result.usage?.prompt_tokens ?? 0,\n                outputTokens: result.usage?.completion_tokens ?? 0,\n              },\n            })\n          }\n          return result\n        },\n        (error: any) => {\n          sendEventToPosthog({\n            client: this.phClient,\n            distinctId: posthogDistinctId ?? traceId,\n            traceId,\n            model: openAIParams.model,\n            provider: 'openai',\n            input: openAIParams.messages,\n            output: [],\n            latency: 0,\n            baseURL: (this as any).baseURL ?? '',\n            params: body,\n            httpStatus: error?.status ? error.status : 500,\n            usage: {\n              inputTokens: 0,\n              outputTokens: 0,\n            },\n            isError: true,\n            error: JSON.stringify(error),\n          })\n          throw error\n        }\n      ) as APIPromise<ChatCompletion>\n\n      return wrappedPromise\n    }\n  }\n}\n\nexport default PostHogOpenAI\n","import OpenAIOrignal, { AzureOpenAI } from 'openai'\nimport { PostHog } from 'posthog-node'\nimport { v4 as uuidv4 } from 'uuid'\nimport { formatResponseOpenAI, MonitoringParams, sendEventToPosthog } from '../utils'\n\ntype ChatCompletion = OpenAIOrignal.ChatCompletion\ntype ChatCompletionChunk = OpenAIOrignal.ChatCompletionChunk\ntype ChatCompletionCreateParamsBase = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParams\ntype ChatCompletionCreateParamsNonStreaming = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParamsNonStreaming\ntype ChatCompletionCreateParamsStreaming = OpenAIOrignal.Chat.Completions.ChatCompletionCreateParamsStreaming\nimport type { APIPromise, RequestOptions } from 'openai/core'\nimport type { Stream } from 'openai/streaming'\n\ninterface MonitoringOpenAIConfig {\n  apiKey: string\n  posthog: PostHog\n  baseURL?: string\n}\n\nexport class PostHogAzureOpenAI extends AzureOpenAI {\n  private readonly phClient: PostHog\n  public chat: WrappedChat\n\n  constructor(config: MonitoringOpenAIConfig) {\n    const { posthog, ...openAIConfig } = config\n    super(openAIConfig)\n    this.phClient = posthog\n    this.chat = new WrappedChat(this, this.phClient)\n  }\n}\n\nexport class WrappedChat extends AzureOpenAI.Chat {\n  constructor(parentClient: PostHogAzureOpenAI, phClient: PostHog) {\n    super(parentClient)\n    this.completions = new WrappedCompletions(parentClient, phClient)\n  }\n\n  public completions: WrappedCompletions\n}\n\nexport class WrappedCompletions extends AzureOpenAI.Chat.Completions {\n  private readonly phClient: PostHog\n\n  constructor(client: AzureOpenAI, phClient: PostHog) {\n    super(client)\n    this.phClient = phClient\n  }\n\n  // --- Overload #1: Non-streaming\n  public create(\n    body: ChatCompletionCreateParamsNonStreaming & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion>\n\n  // --- Overload #2: Streaming\n  public create(\n    body: ChatCompletionCreateParamsStreaming & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<Stream<ChatCompletionChunk>>\n\n  // --- Overload #3: Generic base\n  public create(\n    body: ChatCompletionCreateParamsBase & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion | Stream<ChatCompletionChunk>>\n\n  // --- Implementation Signature\n  public create(\n    body: ChatCompletionCreateParamsBase & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<ChatCompletion | Stream<ChatCompletionChunk>> {\n    const {\n      posthogDistinctId,\n      posthogTraceId,\n      posthogProperties,\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      posthogPrivacyMode = false,\n      posthogGroups,\n      ...openAIParams\n    } = body\n\n    const traceId = posthogTraceId ?? uuidv4()\n    const startTime = Date.now()\n    const parentPromise = super.create(openAIParams, options)\n\n    if (openAIParams.stream) {\n      return parentPromise.then((value) => {\n        let accumulatedContent = ''\n        let usage: { inputTokens: number; outputTokens: number } = {\n          inputTokens: 0,\n          outputTokens: 0,\n        }\n        let model = openAIParams.model\n        if ('tee' in value) {\n          const [stream1, stream2] = value.tee()\n          ;(async () => {\n            try {\n              for await (const chunk of stream1) {\n                const delta = chunk?.choices?.[0]?.delta?.content ?? ''\n                accumulatedContent += delta\n                if (chunk.usage) {\n                  if (chunk.model != model) {\n                    model = chunk.model\n                  }\n                  usage = {\n                    inputTokens: chunk.usage.prompt_tokens ?? 0,\n                    outputTokens: chunk.usage.completion_tokens ?? 0,\n                  }\n                }\n              }\n              const latency = (Date.now() - startTime) / 1000\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model,\n                provider: 'azure',\n                input: openAIParams.messages,\n                output: [{ content: accumulatedContent, role: 'assistant' }],\n                latency,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: 200,\n                usage,\n              })\n            } catch (error: any) {\n              // error handling\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model,\n                provider: 'azure',\n                input: openAIParams.messages,\n                output: JSON.stringify(error),\n                latency: 0,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: error?.status ? error.status : 500,\n                usage: {\n                  inputTokens: 0,\n                  outputTokens: 0,\n                },\n                isError: true,\n                error: JSON.stringify(error),\n              })\n            }\n          })()\n\n          // Return the other stream to the user\n          return stream2\n        }\n        return value\n      }) as APIPromise<Stream<ChatCompletionChunk>>\n    } else {\n      const wrappedPromise = parentPromise.then(\n        (result) => {\n          if ('choices' in result) {\n            const latency = (Date.now() - startTime) / 1000\n            let model = openAIParams.model\n            if (result.model != model) {\n              model = result.model\n            }\n            sendEventToPosthog({\n              client: this.phClient,\n              distinctId: posthogDistinctId ?? traceId,\n              traceId,\n              model,\n              provider: 'azure',\n              input: openAIParams.messages,\n              output: formatResponseOpenAI(result),\n              latency,\n              baseURL: (this as any).baseURL ?? '',\n              params: body,\n              httpStatus: 200,\n              usage: {\n                inputTokens: result.usage?.prompt_tokens ?? 0,\n                outputTokens: result.usage?.completion_tokens ?? 0,\n              },\n            })\n          }\n          return result\n        },\n        (error: any) => {\n          sendEventToPosthog({\n            client: this.phClient,\n            distinctId: posthogDistinctId ?? traceId,\n            traceId,\n            model: openAIParams.model,\n            provider: 'azure',\n            input: openAIParams.messages,\n            output: [],\n            latency: 0,\n            baseURL: (this as any).baseURL ?? '',\n            params: body,\n            httpStatus: error?.status ? error.status : 500,\n            usage: {\n              inputTokens: 0,\n              outputTokens: 0,\n            },\n            isError: true,\n            error: JSON.stringify(error),\n          })\n          throw error\n        }\n      ) as APIPromise<ChatCompletion>\n\n      return wrappedPromise\n    }\n  }\n}\n\nexport default PostHogAzureOpenAI\n","import { experimental_wrapLanguageModel as wrapLanguageModel } from 'ai'\nimport type { LanguageModelV1, LanguageModelV1Middleware, LanguageModelV1Prompt, LanguageModelV1StreamPart } from 'ai'\nimport { v4 as uuidv4 } from 'uuid'\nimport { PostHog } from 'posthog-node'\nimport { CostOverride, sendEventToPosthog } from '../utils'\n\ninterface ClientOptions {\n  posthogDistinctId?: string\n  posthogTraceId?: string\n  posthogProperties?: Record<string, any>\n  posthogPrivacyMode?: boolean\n  posthogGroups?: Record<string, any>\n  posthogModelOverride?: string\n  posthogProviderOverride?: string\n  posthogCostOverride?: CostOverride\n}\n\ninterface CreateInstrumentationMiddlewareOptions {\n  posthogDistinctId: string\n  posthogTraceId: string\n  posthogProperties?: Record<string, any>\n  posthogPrivacyMode?: boolean\n  posthogGroups?: Record<string, any>\n  posthogModelOverride?: string\n  posthogProviderOverride?: string\n  posthogCostOverride?: CostOverride\n}\n\ninterface PostHogInput {\n  content: string\n  role: string\n}\n\nconst mapVercelParams = (params: any): Record<string, any> => {\n  return {\n    temperature: params.temperature,\n    max_tokens: params.maxTokens,\n    top_p: params.topP,\n    frequency_penalty: params.frequencyPenalty,\n    presence_penalty: params.presencePenalty,\n    stop: params.stopSequences,\n    stream: params.stream,\n  }\n}\n\nconst mapVercelPrompt = (prompt: LanguageModelV1Prompt): PostHogInput[] => {\n  return prompt.map((p) => {\n    let content = ''\n    if (Array.isArray(p.content)) {\n      content = p.content\n        .map((c) => {\n          if (c.type === 'text') {\n            return c.text\n          }\n          return ''\n        })\n        .join('')\n    } else {\n      content = p.content\n    }\n    return {\n      role: p.role,\n      content,\n    }\n  })\n}\n\nconst extractProvider = (model: LanguageModelV1): string => {\n  // vercel provider is in the format of provider.endpoint\n  const provider = model.provider.toLowerCase()\n  const providerName = provider.split('.')[0]\n  return providerName\n}\n\nexport const createInstrumentationMiddleware = (\n  phClient: PostHog,\n  model: LanguageModelV1,\n  options: CreateInstrumentationMiddlewareOptions\n): LanguageModelV1Middleware => {\n  const middleware: LanguageModelV1Middleware = {\n    wrapGenerate: async ({ doGenerate, params }) => {\n      const startTime = Date.now()\n      const mergedParams = {\n        ...options,\n        ...mapVercelParams(params),\n      }\n      try {\n        const result = await doGenerate()\n        const latency = (Date.now() - startTime) / 1000\n        const modelId =\n          options.posthogModelOverride ?? (result.response?.modelId ? result.response.modelId : model.modelId)\n        const provider = options.posthogProviderOverride ?? extractProvider(model)\n        const baseURL = '' // cannot currently get baseURL from vercel\n        let content = result.text\n        if (!content) {\n          // support generate Object\n          content = result.toolCalls?.[0].args || JSON.stringify(result)\n        }\n        sendEventToPosthog({\n          client: phClient,\n          distinctId: options.posthogDistinctId,\n          traceId: options.posthogTraceId,\n          model: modelId,\n          provider: provider,\n          input: options.posthogPrivacyMode ? '' : mapVercelPrompt(params.prompt),\n          output: [{ content, role: 'assistant' }],\n          latency,\n          baseURL,\n          params: mergedParams as any,\n          httpStatus: 200,\n          usage: {\n            inputTokens: result.usage.promptTokens,\n            outputTokens: result.usage.completionTokens,\n          },\n        })\n\n        return result\n      } catch (error: any) {\n        const modelId = model.modelId\n        sendEventToPosthog({\n          client: phClient,\n          distinctId: options.posthogDistinctId,\n          traceId: options.posthogTraceId,\n          model: modelId,\n          provider: model.provider,\n          input: options.posthogPrivacyMode ? '' : mapVercelPrompt(params.prompt),\n          output: [],\n          latency: 0,\n          baseURL: '',\n          params: mergedParams as any,\n          httpStatus: error?.status ? error.status : 500,\n          usage: {\n            inputTokens: 0,\n            outputTokens: 0,\n          },\n          isError: true,\n          error: JSON.stringify(error),\n        })\n        throw error\n      }\n    },\n\n    wrapStream: async ({ doStream, params }) => {\n      const startTime = Date.now()\n      let generatedText = ''\n      let usage: { inputTokens?: number; outputTokens?: number } = {}\n      const mergedParams = {\n        ...options,\n        ...mapVercelParams(params),\n      }\n\n      const modelId = options.posthogModelOverride ?? model.modelId\n      const provider = options.posthogProviderOverride ?? extractProvider(model)\n      const baseURL = '' // cannot currently get baseURL from vercel\n      try {\n        const { stream, ...rest } = await doStream()\n        const transformStream = new TransformStream<LanguageModelV1StreamPart, LanguageModelV1StreamPart>({\n          transform(chunk, controller) {\n            if (chunk.type === 'text-delta') {\n              generatedText += chunk.textDelta\n            }\n            if (chunk.type === 'finish') {\n              usage = {\n                inputTokens: chunk.usage?.promptTokens,\n                outputTokens: chunk.usage?.completionTokens,\n              }\n            }\n            controller.enqueue(chunk)\n          },\n\n          flush() {\n            const latency = (Date.now() - startTime) / 1000\n            sendEventToPosthog({\n              client: phClient,\n              distinctId: options.posthogDistinctId,\n              traceId: options.posthogTraceId,\n              model: modelId,\n              provider: provider,\n              input: options.posthogPrivacyMode ? '' : mapVercelPrompt(params.prompt),\n              output: [{ content: generatedText, role: 'assistant' }],\n              latency,\n              baseURL,\n              params: mergedParams as any,\n              httpStatus: 200,\n              usage,\n            })\n          },\n        })\n\n        return {\n          stream: stream.pipeThrough(transformStream),\n          ...rest,\n        }\n      } catch (error: any) {\n        sendEventToPosthog({\n          client: phClient,\n          distinctId: options.posthogDistinctId,\n          traceId: options.posthogTraceId,\n          model: modelId,\n          provider: provider,\n          input: options.posthogPrivacyMode ? '' : mapVercelPrompt(params.prompt),\n          output: [],\n          latency: 0,\n          baseURL: '',\n          params: mergedParams as any,\n          httpStatus: error?.status ? error.status : 500,\n          usage: {\n            inputTokens: 0,\n            outputTokens: 0,\n          },\n          isError: true,\n          error: JSON.stringify(error),\n        })\n        throw error\n      }\n    },\n  }\n\n  return middleware\n}\n\nexport const wrapVercelLanguageModel = (\n  model: LanguageModelV1,\n  phClient: PostHog,\n  options: ClientOptions\n): LanguageModelV1 => {\n  const traceId = options.posthogTraceId ?? uuidv4()\n  const middleware = createInstrumentationMiddleware(phClient, model, {\n    ...options,\n    posthogTraceId: traceId,\n    posthogDistinctId: options.posthogDistinctId ?? traceId,\n  })\n\n  const wrappedModel = wrapLanguageModel({\n    model,\n    middleware,\n  })\n\n  return wrappedModel\n}\n","import AnthropicOriginal from '@anthropic-ai/sdk'\nimport { PostHog } from 'posthog-node'\nimport { v4 as uuidv4 } from 'uuid'\nimport { formatResponseAnthropic, mergeSystemPrompt, MonitoringParams, sendEventToPosthog } from '../utils'\n\ntype MessageCreateParamsNonStreaming = AnthropicOriginal.Messages.MessageCreateParamsNonStreaming\ntype MessageCreateParamsStreaming = AnthropicOriginal.Messages.MessageCreateParamsStreaming\ntype MessageCreateParams = AnthropicOriginal.Messages.MessageCreateParams\ntype Message = AnthropicOriginal.Messages.Message\ntype RawMessageStreamEvent = AnthropicOriginal.Messages.RawMessageStreamEvent\ntype MessageCreateParamsBase = AnthropicOriginal.Messages.MessageCreateParams\n\nimport type { APIPromise, RequestOptions } from '@anthropic-ai/sdk/core'\nimport type { Stream } from '@anthropic-ai/sdk/streaming'\n\ninterface MonitoringAnthropicConfig {\n  apiKey: string\n  posthog: PostHog\n  baseURL?: string\n}\n\nexport class PostHogAnthropic extends AnthropicOriginal {\n  private readonly phClient: PostHog\n  public messages: WrappedMessages\n\n  constructor(config: MonitoringAnthropicConfig) {\n    const { posthog, ...anthropicConfig } = config\n    super(anthropicConfig)\n    this.phClient = posthog\n    this.messages = new WrappedMessages(this, this.phClient)\n  }\n}\n\nexport class WrappedMessages extends AnthropicOriginal.Messages {\n  private readonly phClient: PostHog\n\n  constructor(parentClient: PostHogAnthropic, phClient: PostHog) {\n    super(parentClient)\n    this.phClient = phClient\n  }\n\n  public create(body: MessageCreateParamsNonStreaming, options?: RequestOptions): APIPromise<Message>\n  public create(\n    body: MessageCreateParamsStreaming & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<Stream<RawMessageStreamEvent>>\n  public create(\n    body: MessageCreateParamsBase & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<Stream<RawMessageStreamEvent> | Message>\n  public create(\n    body: MessageCreateParams & MonitoringParams,\n    options?: RequestOptions\n  ): APIPromise<Message> | APIPromise<Stream<RawMessageStreamEvent>> {\n    const {\n      posthogDistinctId,\n      posthogTraceId,\n      posthogProperties,\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      posthogPrivacyMode = false,\n      posthogGroups,\n      ...anthropicParams\n    } = body\n\n    const traceId = posthogTraceId ?? uuidv4()\n    const startTime = Date.now()\n\n    const parentPromise = super.create(anthropicParams, options)\n\n    if (anthropicParams.stream) {\n      return parentPromise.then((value) => {\n        let accumulatedContent = ''\n        const usage: { inputTokens: number; outputTokens: number } = {\n          inputTokens: 0,\n          outputTokens: 0,\n        }\n        if ('tee' in value) {\n          const [stream1, stream2] = value.tee()\n          ;(async () => {\n            try {\n              for await (const chunk of stream1) {\n                if ('delta' in chunk) {\n                  if ('text' in chunk.delta) {\n                    const delta = chunk?.delta?.text ?? ''\n                    accumulatedContent += delta\n                  }\n                }\n                if (chunk.type == 'message_start') {\n                  usage.inputTokens = chunk.message.usage.input_tokens ?? 0\n                }\n                if ('usage' in chunk) {\n                  usage.outputTokens = chunk.usage.output_tokens ?? 0\n                }\n              }\n              const latency = (Date.now() - startTime) / 1000\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model: anthropicParams.model,\n                provider: 'anthropic',\n                input: mergeSystemPrompt(anthropicParams, 'anthropic'),\n                output: [{ content: accumulatedContent, role: 'assistant' }],\n                latency,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: 200,\n                usage,\n              })\n            } catch (error: any) {\n              // error handling\n              sendEventToPosthog({\n                client: this.phClient,\n                distinctId: posthogDistinctId ?? traceId,\n                traceId,\n                model: anthropicParams.model,\n                provider: 'anthropic',\n                input: mergeSystemPrompt(anthropicParams, 'anthropic'),\n                output: [],\n                latency: 0,\n                baseURL: (this as any).baseURL ?? '',\n                params: body,\n                httpStatus: error?.status ? error.status : 500,\n                usage: {\n                  inputTokens: 0,\n                  outputTokens: 0,\n                },\n                isError: true,\n                error: JSON.stringify(error),\n              })\n            }\n          })()\n\n          // Return the other stream to the user\n          return stream2\n        }\n        return value\n      }) as APIPromise<Stream<RawMessageStreamEvent>>\n    } else {\n      const wrappedPromise = parentPromise.then(\n        (result) => {\n          if ('content' in result) {\n            const latency = (Date.now() - startTime) / 1000\n            sendEventToPosthog({\n              client: this.phClient,\n              distinctId: posthogDistinctId ?? traceId,\n              traceId,\n              model: anthropicParams.model,\n              provider: 'anthropic',\n              input: mergeSystemPrompt(anthropicParams, 'anthropic'),\n              output: formatResponseAnthropic(result),\n              latency,\n              baseURL: (this as any).baseURL ?? '',\n              params: body,\n              httpStatus: 200,\n              usage: {\n                inputTokens: result.usage.input_tokens ?? 0,\n                outputTokens: result.usage.output_tokens ?? 0,\n              },\n            })\n          }\n          return result\n        },\n        (error: any) => {\n          sendEventToPosthog({\n            client: this.phClient,\n            distinctId: posthogDistinctId ?? traceId,\n            traceId,\n            model: anthropicParams.model,\n            provider: 'anthropic',\n            input: mergeSystemPrompt(anthropicParams, 'anthropic'),\n            output: [],\n            latency: 0,\n            baseURL: (this as any).baseURL ?? '',\n            params: body,\n            httpStatus: error?.status ? error.status : 500,\n            usage: {\n              inputTokens: 0,\n              outputTokens: 0,\n            },\n            isError: true,\n            error: JSON.stringify(error),\n          })\n          throw error\n        }\n      ) as APIPromise<Message>\n\n      return wrappedPromise\n    }\n  }\n}\n\nexport default PostHogAnthropic\n","'use strict';\nmodule.exports = function (str, sep) {\n\tif (typeof str !== 'string') {\n\t\tthrow new TypeError('Expected a string');\n\t}\n\n\tsep = typeof sep === 'undefined' ? '_' : sep;\n\n\treturn str\n\t\t.replace(/([a-z\\d])([A-Z])/g, '$1' + sep + '$2')\n\t\t.replace(/([A-Z]+)([A-Z][a-z\\d]+)/g, '$1' + sep + '$2')\n\t\t.toLowerCase();\n};\n","'use strict';\n\nconst UPPERCASE = /[\\p{Lu}]/u;\nconst LOWERCASE = /[\\p{Ll}]/u;\nconst LEADING_CAPITAL = /^[\\p{Lu}](?![\\p{Lu}])/gu;\nconst IDENTIFIER = /([\\p{Alpha}\\p{N}_]|$)/u;\nconst SEPARATORS = /[_.\\- ]+/;\n\nconst LEADING_SEPARATORS = new RegExp('^' + SEPARATORS.source);\nconst SEPARATORS_AND_IDENTIFIER = new RegExp(SEPARATORS.source + IDENTIFIER.source, 'gu');\nconst NUMBERS_AND_IDENTIFIER = new RegExp('\\\\d+' + IDENTIFIER.source, 'gu');\n\nconst preserveCamelCase = (string, toLowerCase, toUpperCase) => {\n\tlet isLastCharLower = false;\n\tlet isLastCharUpper = false;\n\tlet isLastLastCharUpper = false;\n\n\tfor (let i = 0; i < string.length; i++) {\n\t\tconst character = string[i];\n\n\t\tif (isLastCharLower && UPPERCASE.test(character)) {\n\t\t\tstring = string.slice(0, i) + '-' + string.slice(i);\n\t\t\tisLastCharLower = false;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = true;\n\t\t\ti++;\n\t\t} else if (isLastCharUpper && isLastLastCharUpper && LOWERCASE.test(character)) {\n\t\t\tstring = string.slice(0, i - 1) + '-' + string.slice(i - 1);\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = false;\n\t\t\tisLastCharLower = true;\n\t\t} else {\n\t\t\tisLastCharLower = toLowerCase(character) === character && toUpperCase(character) !== character;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = toUpperCase(character) === character && toLowerCase(character) !== character;\n\t\t}\n\t}\n\n\treturn string;\n};\n\nconst preserveConsecutiveUppercase = (input, toLowerCase) => {\n\tLEADING_CAPITAL.lastIndex = 0;\n\n\treturn input.replace(LEADING_CAPITAL, m1 => toLowerCase(m1));\n};\n\nconst postProcess = (input, toUpperCase) => {\n\tSEPARATORS_AND_IDENTIFIER.lastIndex = 0;\n\tNUMBERS_AND_IDENTIFIER.lastIndex = 0;\n\n\treturn input.replace(SEPARATORS_AND_IDENTIFIER, (_, identifier) => toUpperCase(identifier))\n\t\t.replace(NUMBERS_AND_IDENTIFIER, m => toUpperCase(m));\n};\n\nconst camelCase = (input, options) => {\n\tif (!(typeof input === 'string' || Array.isArray(input))) {\n\t\tthrow new TypeError('Expected the input to be `string | string[]`');\n\t}\n\n\toptions = {\n\t\tpascalCase: false,\n\t\tpreserveConsecutiveUppercase: false,\n\t\t...options\n\t};\n\n\tif (Array.isArray(input)) {\n\t\tinput = input.map(x => x.trim())\n\t\t\t.filter(x => x.length)\n\t\t\t.join('-');\n\t} else {\n\t\tinput = input.trim();\n\t}\n\n\tif (input.length === 0) {\n\t\treturn '';\n\t}\n\n\tconst toLowerCase = options.locale === false ?\n\t\tstring => string.toLowerCase() :\n\t\tstring => string.toLocaleLowerCase(options.locale);\n\tconst toUpperCase = options.locale === false ?\n\t\tstring => string.toUpperCase() :\n\t\tstring => string.toLocaleUpperCase(options.locale);\n\n\tif (input.length === 1) {\n\t\treturn options.pascalCase ? toUpperCase(input) : toLowerCase(input);\n\t}\n\n\tconst hasUpperCase = input !== toLowerCase(input);\n\n\tif (hasUpperCase) {\n\t\tinput = preserveCamelCase(input, toLowerCase, toUpperCase);\n\t}\n\n\tinput = input.replace(LEADING_SEPARATORS, '');\n\n\tif (options.preserveConsecutiveUppercase) {\n\t\tinput = preserveConsecutiveUppercase(input, toLowerCase);\n\t} else {\n\t\tinput = toLowerCase(input);\n\t}\n\n\tif (options.pascalCase) {\n\t\tinput = toUpperCase(input.charAt(0)) + input.slice(1);\n\t}\n\n\treturn postProcess(input, toUpperCase);\n};\n\nmodule.exports = camelCase;\n// TODO: Remove this for the next major release\nmodule.exports.default = camelCase;\n","import snakeCase from \"decamelize\";\nimport camelCase from \"camelcase\";\nexport function keyToJson(key, map) {\n    return map?.[key] || snakeCase(key);\n}\nexport function keyFromJson(key, map) {\n    return map?.[key] || camelCase(key);\n}\nexport function mapKeys(fields, mapper, map) {\n    const mapped = {};\n    for (const key in fields) {\n        if (Object.hasOwn(fields, key)) {\n            mapped[mapper(key, map)] = fields[key];\n        }\n    }\n    return mapped;\n}\n","import { keyToJson, mapKeys } from \"./map_keys.js\";\nfunction shallowCopy(obj) {\n    return Array.isArray(obj) ? [...obj] : { ...obj };\n}\nfunction replaceSecrets(root, secretsMap) {\n    const result = shallowCopy(root);\n    for (const [path, secretId] of Object.entries(secretsMap)) {\n        const [last, ...partsReverse] = path.split(\".\").reverse();\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        let current = result;\n        for (const part of partsReverse.reverse()) {\n            if (current[part] === undefined) {\n                break;\n            }\n            current[part] = shallowCopy(current[part]);\n            current = current[part];\n        }\n        if (current[last] !== undefined) {\n            current[last] = {\n                lc: 1,\n                type: \"secret\",\n                id: [secretId],\n            };\n        }\n    }\n    return result;\n}\n/**\n * Get a unique name for the module, rather than parent class implementations.\n * Should not be subclassed, subclass lc_name above instead.\n */\nexport function get_lc_unique_name(\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nserializableClass) {\n    // \"super\" here would refer to the parent class of Serializable,\n    // when we want the parent class of the module actually calling this method.\n    const parentClass = Object.getPrototypeOf(serializableClass);\n    const lcNameIsSubclassed = typeof serializableClass.lc_name === \"function\" &&\n        (typeof parentClass.lc_name !== \"function\" ||\n            serializableClass.lc_name() !== parentClass.lc_name());\n    if (lcNameIsSubclassed) {\n        return serializableClass.lc_name();\n    }\n    else {\n        return serializableClass.name;\n    }\n}\nexport class Serializable {\n    /**\n     * The name of the serializable. Override to provide an alias or\n     * to preserve the serialized module name in minified environments.\n     *\n     * Implemented as a static method to support loading logic.\n     */\n    static lc_name() {\n        return this.name;\n    }\n    /**\n     * The final serialized identifier for the module.\n     */\n    get lc_id() {\n        return [\n            ...this.lc_namespace,\n            get_lc_unique_name(this.constructor),\n        ];\n    }\n    /**\n     * A map of secrets, which will be omitted from serialization.\n     * Keys are paths to the secret in constructor args, e.g. \"foo.bar.baz\".\n     * Values are the secret ids, which will be used when deserializing.\n     */\n    get lc_secrets() {\n        return undefined;\n    }\n    /**\n     * A map of additional attributes to merge with constructor args.\n     * Keys are the attribute names, e.g. \"foo\".\n     * Values are the attribute values, which will be serialized.\n     * These attributes need to be accepted by the constructor as arguments.\n     */\n    get lc_attributes() {\n        return undefined;\n    }\n    /**\n     * A map of aliases for constructor args.\n     * Keys are the attribute names, e.g. \"foo\".\n     * Values are the alias that will replace the key in serialization.\n     * This is used to eg. make argument names match Python.\n     */\n    get lc_aliases() {\n        return undefined;\n    }\n    constructor(kwargs, ..._args) {\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"lc_kwargs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.lc_kwargs = kwargs || {};\n    }\n    toJSON() {\n        if (!this.lc_serializable) {\n            return this.toJSONNotImplemented();\n        }\n        if (\n        // eslint-disable-next-line no-instanceof/no-instanceof\n        this.lc_kwargs instanceof Serializable ||\n            typeof this.lc_kwargs !== \"object\" ||\n            Array.isArray(this.lc_kwargs)) {\n            // We do not support serialization of classes with arg not a POJO\n            // I'm aware the check above isn't as strict as it could be\n            return this.toJSONNotImplemented();\n        }\n        const aliases = {};\n        const secrets = {};\n        const kwargs = Object.keys(this.lc_kwargs).reduce((acc, key) => {\n            acc[key] = key in this ? this[key] : this.lc_kwargs[key];\n            return acc;\n        }, {});\n        // get secrets, attributes and aliases from all superclasses\n        for (\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let current = Object.getPrototypeOf(this); current; current = Object.getPrototypeOf(current)) {\n            Object.assign(aliases, Reflect.get(current, \"lc_aliases\", this));\n            Object.assign(secrets, Reflect.get(current, \"lc_secrets\", this));\n            Object.assign(kwargs, Reflect.get(current, \"lc_attributes\", this));\n        }\n        // include all secrets used, even if not in kwargs,\n        // will be replaced with sentinel value in replaceSecrets\n        Object.keys(secrets).forEach((keyPath) => {\n            // eslint-disable-next-line @typescript-eslint/no-this-alias, @typescript-eslint/no-explicit-any\n            let read = this;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            let write = kwargs;\n            const [last, ...partsReverse] = keyPath.split(\".\").reverse();\n            for (const key of partsReverse.reverse()) {\n                if (!(key in read) || read[key] === undefined)\n                    return;\n                if (!(key in write) || write[key] === undefined) {\n                    if (typeof read[key] === \"object\" && read[key] != null) {\n                        write[key] = {};\n                    }\n                    else if (Array.isArray(read[key])) {\n                        write[key] = [];\n                    }\n                }\n                read = read[key];\n                write = write[key];\n            }\n            if (last in read && read[last] !== undefined) {\n                write[last] = write[last] || read[last];\n            }\n        });\n        return {\n            lc: 1,\n            type: \"constructor\",\n            id: this.lc_id,\n            kwargs: mapKeys(Object.keys(secrets).length ? replaceSecrets(kwargs, secrets) : kwargs, keyToJson, aliases),\n        };\n    }\n    toJSONNotImplemented() {\n        return {\n            lc: 1,\n            type: \"not_implemented\",\n            id: this.lc_id,\n        };\n    }\n}\n","export const isBrowser = () => typeof window !== \"undefined\" && typeof window.document !== \"undefined\";\nexport const isWebWorker = () => typeof globalThis === \"object\" &&\n    globalThis.constructor &&\n    globalThis.constructor.name === \"DedicatedWorkerGlobalScope\";\nexport const isJsDom = () => (typeof window !== \"undefined\" && window.name === \"nodejs\") ||\n    (typeof navigator !== \"undefined\" &&\n        (navigator.userAgent.includes(\"Node.js\") ||\n            navigator.userAgent.includes(\"jsdom\")));\n// Supabase Edge Function provides a `Deno` global object\n// without `version` property\nexport const isDeno = () => typeof Deno !== \"undefined\";\n// Mark not-as-node if in Supabase Edge Function\nexport const isNode = () => typeof process !== \"undefined\" &&\n    typeof process.versions !== \"undefined\" &&\n    typeof process.versions.node !== \"undefined\" &&\n    !isDeno();\nexport const getEnv = () => {\n    let env;\n    if (isBrowser()) {\n        env = \"browser\";\n    }\n    else if (isNode()) {\n        env = \"node\";\n    }\n    else if (isWebWorker()) {\n        env = \"webworker\";\n    }\n    else if (isJsDom()) {\n        env = \"jsdom\";\n    }\n    else if (isDeno()) {\n        env = \"deno\";\n    }\n    else {\n        env = \"other\";\n    }\n    return env;\n};\nlet runtimeEnvironment;\nexport async function getRuntimeEnvironment() {\n    if (runtimeEnvironment === undefined) {\n        const env = getEnv();\n        runtimeEnvironment = {\n            library: \"langchain-js\",\n            runtime: env,\n        };\n    }\n    return runtimeEnvironment;\n}\nexport function getEnvironmentVariable(name) {\n    // Certain Deno setups will throw an error if you try to access environment variables\n    // https://github.com/langchain-ai/langchainjs/issues/1412\n    try {\n        if (typeof process !== \"undefined\") {\n            // eslint-disable-next-line no-process-env\n            return process.env?.[name];\n        }\n        else if (isDeno()) {\n            return Deno?.env.get(name);\n        }\n        else {\n            return undefined;\n        }\n    }\n    catch (e) {\n        return undefined;\n    }\n}\n","import * as uuid from \"uuid\";\nimport { Serializable, get_lc_unique_name, } from \"../load/serializable.js\";\nimport { getEnvironmentVariable } from \"../utils/env.js\";\n/**\n * Abstract class that provides a set of optional methods that can be\n * overridden in derived classes to handle various events during the\n * execution of a LangChain application.\n */\nclass BaseCallbackHandlerMethodsClass {\n}\nexport function callbackHandlerPrefersStreaming(x) {\n    return \"lc_prefer_streaming\" in x && x.lc_prefer_streaming;\n}\n/**\n * Abstract base class for creating callback handlers in the LangChain\n * framework. It provides a set of optional methods that can be overridden\n * in derived classes to handle various events during the execution of a\n * LangChain application.\n */\nexport class BaseCallbackHandler extends BaseCallbackHandlerMethodsClass {\n    get lc_namespace() {\n        return [\"langchain_core\", \"callbacks\", this.name];\n    }\n    get lc_secrets() {\n        return undefined;\n    }\n    get lc_attributes() {\n        return undefined;\n    }\n    get lc_aliases() {\n        return undefined;\n    }\n    /**\n     * The name of the serializable. Override to provide an alias or\n     * to preserve the serialized module name in minified environments.\n     *\n     * Implemented as a static method to support loading logic.\n     */\n    static lc_name() {\n        return this.name;\n    }\n    /**\n     * The final serialized identifier for the module.\n     */\n    get lc_id() {\n        return [\n            ...this.lc_namespace,\n            get_lc_unique_name(this.constructor),\n        ];\n    }\n    constructor(input) {\n        super();\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"lc_kwargs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"ignoreLLM\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"ignoreChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"ignoreAgent\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"ignoreRetriever\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"ignoreCustomEvent\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"raiseError\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"awaitHandlers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: getEnvironmentVariable(\"LANGCHAIN_CALLBACKS_BACKGROUND\") === \"false\"\n        });\n        this.lc_kwargs = input || {};\n        if (input) {\n            this.ignoreLLM = input.ignoreLLM ?? this.ignoreLLM;\n            this.ignoreChain = input.ignoreChain ?? this.ignoreChain;\n            this.ignoreAgent = input.ignoreAgent ?? this.ignoreAgent;\n            this.ignoreRetriever = input.ignoreRetriever ?? this.ignoreRetriever;\n            this.ignoreCustomEvent =\n                input.ignoreCustomEvent ?? this.ignoreCustomEvent;\n            this.raiseError = input.raiseError ?? this.raiseError;\n            this.awaitHandlers =\n                this.raiseError || (input._awaitHandler ?? this.awaitHandlers);\n        }\n    }\n    copy() {\n        return new this.constructor(this);\n    }\n    toJSON() {\n        return Serializable.prototype.toJSON.call(this);\n    }\n    toJSONNotImplemented() {\n        return Serializable.prototype.toJSONNotImplemented.call(this);\n    }\n    static fromMethods(methods) {\n        class Handler extends BaseCallbackHandler {\n            constructor() {\n                super();\n                Object.defineProperty(this, \"name\", {\n                    enumerable: true,\n                    configurable: true,\n                    writable: true,\n                    value: uuid.v4()\n                });\n                Object.assign(this, methods);\n            }\n        }\n        return new Handler();\n    }\n}\nexport const isBaseCallbackHandler = (x) => {\n    const callbackHandler = x;\n    return (callbackHandler !== undefined &&\n        typeof callbackHandler.copy === \"function\" &&\n        typeof callbackHandler.name === \"string\" &&\n        typeof callbackHandler.awaitHandlers === \"boolean\");\n};\n","import { PostHog } from 'posthog-node'\nimport { withPrivacyMode, getModelParams } from '../utils'\nimport { BaseCallbackHandler } from '@langchain/core/callbacks/base'\nimport type { Serialized } from '@langchain/core/load/serializable'\nimport type { ChainValues } from '@langchain/core/utils/types'\nimport type { BaseMessage } from '@langchain/core/messages'\nimport type { LLMResult } from '@langchain/core/outputs'\nimport type { AgentAction, AgentFinish } from '@langchain/core/agents'\nimport type { DocumentInterface } from '@langchain/core/documents'\n\ninterface SpanMetadata {\n  /** Name of the trace/span (e.g. chain name) */\n  name: string\n  /** Timestamp (in ms) when the run started */\n  startTime: number\n  /** Timestamp (in ms) when the run ended (if already finished) */\n  endTime?: number\n  /** The input state */\n  input?: any\n}\n\ninterface GenerationMetadata extends SpanMetadata {\n  /** Provider used (e.g. openai, anthropic) */\n  provider?: string\n  /** Model name used in the generation */\n  model?: string\n  /** The model parameters (temperature, max_tokens, etc.) */\n  modelParams?: Record<string, any>\n  /** The base URLfor example, the API base used */\n  baseUrl?: string\n}\n\n/** A run may either be a Span or a Generation */\ntype RunMetadata = SpanMetadata | GenerationMetadata\n\n/** Storage for run metadata */\ntype RunMetadataStorage = { [runId: string]: RunMetadata }\n\nexport class LangChainCallbackHandler extends BaseCallbackHandler {\n  public name = 'PosthogCallbackHandler'\n  private client: PostHog\n  private distinctId?: string | number\n  private traceId?: string | number\n  private properties: Record<string, any>\n  private privacyMode: boolean\n  private groups: Record<string, any>\n  private debug: boolean\n\n  private runs: RunMetadataStorage = {}\n  private parentTree: { [runId: string]: string } = {}\n\n  constructor(options: {\n    client: PostHog\n    distinctId?: string | number\n    traceId?: string | number\n    properties?: Record<string, any>\n    privacyMode?: boolean\n    groups?: Record<string, any>\n    debug?: boolean\n  }) {\n    if (!options.client) {\n      throw new Error('PostHog client is required')\n    }\n    super()\n    this.client = options.client\n    this.distinctId = options.distinctId\n    this.traceId = options.traceId\n    this.properties = options.properties || {}\n    this.privacyMode = options.privacyMode || false\n    this.groups = options.groups || {}\n    this.debug = options.debug || false\n  }\n\n  // ===== CALLBACK METHODS =====\n\n  public handleChainStart(\n    chain: Serialized,\n    inputs: ChainValues,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    metadata?: Record<string, unknown>,\n\n    runType?: string,\n    runName?: string\n  ): void {\n    this._logDebugEvent('on_chain_start', runId, parentRunId, { inputs, tags })\n    this._setParentOfRun(runId, parentRunId)\n    this._setTraceOrSpanMetadata(chain, inputs, runId, parentRunId, metadata, tags, runName)\n  }\n\n  public handleChainEnd(\n    outputs: ChainValues,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    kwargs?: { inputs?: Record<string, unknown> }\n  ): void {\n    this._logDebugEvent('on_chain_end', runId, parentRunId, { outputs, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, outputs)\n  }\n\n  public handleChainError(\n    error: Error,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    kwargs?: { inputs?: Record<string, unknown> }\n  ): void {\n    this._logDebugEvent('on_chain_error', runId, parentRunId, { error, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, error)\n  }\n\n  public handleChatModelStart(\n    serialized: Serialized,\n    messages: BaseMessage[][],\n    runId: string,\n    parentRunId?: string,\n    extraParams?: Record<string, unknown>,\n    tags?: string[],\n    metadata?: Record<string, unknown>,\n    runName?: string\n  ): void {\n    this._logDebugEvent('on_chat_model_start', runId, parentRunId, { messages, tags })\n    this._setParentOfRun(runId, parentRunId)\n    // Flatten the two-dimensional messages and convert each message to a plain object\n    const input = messages.flat().map((m) => this._convertMessageToDict(m))\n    this._setLLMMetadata(serialized, runId, input, metadata, extraParams, runName)\n  }\n\n  public handleLLMStart(\n    serialized: Serialized,\n    prompts: string[],\n    runId: string,\n    parentRunId?: string,\n    extraParams?: Record<string, unknown>,\n    tags?: string[],\n    metadata?: Record<string, unknown>,\n    runName?: string\n  ): void {\n    this._logDebugEvent('on_llm_start', runId, parentRunId, { prompts, tags })\n    this._setParentOfRun(runId, parentRunId)\n    this._setLLMMetadata(serialized, runId, prompts, metadata, extraParams, runName)\n  }\n\n  public handleLLMEnd(\n    output: LLMResult,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    extraParams?: Record<string, unknown>\n  ): void {\n    this._logDebugEvent('on_llm_end', runId, parentRunId, { output, tags })\n    this._popRunAndCaptureGeneration(runId, parentRunId, output)\n  }\n\n  public handleLLMError(\n    err: Error,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    extraParams?: Record<string, unknown>\n  ): void {\n    this._logDebugEvent('on_llm_error', runId, parentRunId, { err, tags })\n    this._popRunAndCaptureGeneration(runId, parentRunId, err)\n  }\n\n  public handleToolStart(\n    tool: Serialized,\n    input: string,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    metadata?: Record<string, unknown>,\n    runName?: string\n  ): void {\n    this._logDebugEvent('on_tool_start', runId, parentRunId, { input, tags })\n    this._setParentOfRun(runId, parentRunId)\n    this._setTraceOrSpanMetadata(tool, input, runId, parentRunId, metadata, tags, runName)\n  }\n\n  public handleToolEnd(output: any, runId: string, parentRunId?: string, tags?: string[]): void {\n    this._logDebugEvent('on_tool_end', runId, parentRunId, { output, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, output)\n  }\n\n  public handleToolError(err: Error, runId: string, parentRunId?: string, tags?: string[]): void {\n    this._logDebugEvent('on_tool_error', runId, parentRunId, { err, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, err)\n  }\n\n  public handleRetrieverStart(\n    retriever: Serialized,\n    query: string,\n    runId: string,\n    parentRunId?: string,\n    tags?: string[],\n    metadata?: Record<string, unknown>,\n    name?: string\n  ): void {\n    this._logDebugEvent('on_retriever_start', runId, parentRunId, { query, tags })\n    this._setParentOfRun(runId, parentRunId)\n    this._setTraceOrSpanMetadata(retriever, query, runId, parentRunId, metadata, tags, name)\n  }\n\n  public handleRetrieverEnd(\n    documents: DocumentInterface[],\n    runId: string,\n    parentRunId?: string,\n    tags?: string[]\n  ): void {\n    this._logDebugEvent('on_retriever_end', runId, parentRunId, { documents, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, documents)\n  }\n\n  public handleRetrieverError(err: Error, runId: string, parentRunId?: string, tags?: string[]): void {\n    this._logDebugEvent('on_retriever_error', runId, parentRunId, { err, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, err)\n  }\n\n  public handleAgentAction(action: AgentAction, runId: string, parentRunId?: string, tags?: string[]): void {\n    this._logDebugEvent('on_agent_action', runId, parentRunId, { action, tags })\n    this._setParentOfRun(runId, parentRunId)\n    this._setTraceOrSpanMetadata(null, action, runId, parentRunId)\n  }\n\n  public handleAgentEnd(action: AgentFinish, runId: string, parentRunId?: string, tags?: string[]): void {\n    this._logDebugEvent('on_agent_finish', runId, parentRunId, { action, tags })\n    this._popRunAndCaptureTraceOrSpan(runId, parentRunId, action)\n  }\n\n  // ===== PRIVATE HELPERS =====\n\n  private _setParentOfRun(runId: string, parentRunId?: string): void {\n    if (parentRunId) {\n      this.parentTree[runId] = parentRunId\n    }\n  }\n\n  private _popParentOfRun(runId: string): void {\n    delete this.parentTree[runId]\n  }\n\n  private _findRootRun(runId: string): string {\n    let id = runId\n    while (this.parentTree[id]) {\n      id = this.parentTree[id]\n    }\n    return id\n  }\n\n  private _setTraceOrSpanMetadata(\n    serialized: any,\n    input: any,\n    runId: string,\n    parentRunId?: string,\n    ...args: any[]\n  ): void {\n    // Use default names if not provided: if this is a top-level run, we mark it as a trace, otherwise as a span.\n    const defaultName = parentRunId ? 'span' : 'trace'\n    const runName = this._getLangchainRunName(serialized, ...args) || defaultName\n    this.runs[runId] = {\n      name: runName,\n      input,\n      startTime: Date.now(),\n    } as SpanMetadata\n  }\n\n  private _setLLMMetadata(\n    serialized: Serialized | null,\n    runId: string,\n    messages: any,\n    metadata?: any,\n    extraParams?: any,\n    runName?: string\n  ): void {\n    const runNameFound = this._getLangchainRunName(serialized, { extraParams, runName }) || 'generation'\n    const generation: GenerationMetadata = {\n      name: runNameFound,\n      input: messages,\n      startTime: Date.now(),\n    }\n    if (extraParams) {\n      generation.modelParams = getModelParams(extraParams.invocation_params)\n    }\n    if (metadata) {\n      if (metadata.ls_model_name) {\n        generation.model = metadata.ls_model_name\n      }\n      if (metadata.ls_provider) {\n        generation.provider = metadata.ls_provider\n      }\n    }\n    if (serialized && 'kwargs' in serialized && serialized.kwargs.openai_api_base) {\n      generation.baseUrl = serialized.kwargs.openai_api_base\n    }\n    this.runs[runId] = generation\n  }\n\n  private _popRunMetadata(runId: string): RunMetadata | undefined {\n    const endTime = Date.now()\n    const run = this.runs[runId]\n    if (!run) {\n      console.warn(`No run metadata found for run ${runId}`)\n      return undefined\n    }\n    run.endTime = endTime\n    delete this.runs[runId]\n    return run\n  }\n\n  private _getTraceId(runId: string): string {\n    return this.traceId ? String(this.traceId) : this._findRootRun(runId)\n  }\n\n  private _getParentRunId(traceId: string, runId: string, parentRunId?: string): string | undefined {\n    // Replace the parent-run if not found in our stored parent tree.\n    if (parentRunId && !this.parentTree[parentRunId]) {\n      return traceId\n    }\n    return parentRunId\n  }\n\n  private _popRunAndCaptureTraceOrSpan(\n    runId: string,\n    parentRunId: string | undefined,\n    outputs: ChainValues | DocumentInterface[] | AgentFinish | Error | any\n  ): void {\n    const traceId = this._getTraceId(runId)\n    this._popParentOfRun(runId)\n    const run = this._popRunMetadata(runId)\n    if (!run) {\n      return\n    }\n    if ('modelParams' in run) {\n      console.warn(`Run ${runId} is a generation, but attempted to be captured as a trace/span.`)\n      return\n    }\n    const actualParentRunId = this._getParentRunId(traceId, runId, parentRunId)\n    this._captureTraceOrSpan(traceId, runId, run as SpanMetadata, outputs, actualParentRunId)\n  }\n\n  private _captureTraceOrSpan(\n    traceId: string,\n    runId: string,\n    run: SpanMetadata,\n    outputs: ChainValues | DocumentInterface[] | AgentFinish | Error | any,\n    parentRunId?: string\n  ): void {\n    const eventName = parentRunId ? '$ai_span' : '$ai_trace'\n    const latency = run.endTime ? (run.endTime - run.startTime) / 1000 : 0\n    const eventProperties: Record<string, any> = {\n      $ai_trace_id: traceId,\n      $ai_input_state: withPrivacyMode(this.client, this.privacyMode, run.input),\n      $ai_latency: latency,\n      $ai_span_name: run.name,\n      $ai_span_id: runId,\n    }\n    if (parentRunId) {\n      eventProperties['$ai_parent_id'] = parentRunId\n    }\n\n    Object.assign(eventProperties, this.properties)\n    if (!this.distinctId) {\n      eventProperties['$process_person_profile'] = false\n    }\n    if (outputs instanceof Error) {\n      eventProperties['$ai_error'] = outputs.toString()\n      eventProperties['$ai_is_error'] = true\n    } else if (outputs !== undefined) {\n      eventProperties['$ai_output_state'] = withPrivacyMode(this.client, this.privacyMode, outputs)\n    }\n    this.client.capture({\n      distinctId: this.distinctId ? this.distinctId.toString() : runId,\n      event: eventName,\n      properties: eventProperties,\n      groups: this.groups,\n    })\n  }\n\n  private _popRunAndCaptureGeneration(\n    runId: string,\n    parentRunId: string | undefined,\n    response: LLMResult | Error\n  ): void {\n    const traceId = this._getTraceId(runId)\n    this._popParentOfRun(runId)\n    const run = this._popRunMetadata(runId)\n    if (!run || typeof run !== 'object' || !('modelParams' in run)) {\n      console.warn(`Run ${runId} is not a generation, but attempted to be captured as such.`)\n      return\n    }\n    const actualParentRunId = this._getParentRunId(traceId, runId, parentRunId)\n    this._captureGeneration(traceId, runId, run as GenerationMetadata, response, actualParentRunId)\n  }\n\n  private _captureGeneration(\n    traceId: string,\n    runId: string,\n    run: GenerationMetadata,\n    output: LLMResult | Error,\n    parentRunId?: string\n  ): void {\n    const latency = run.endTime ? (run.endTime - run.startTime) / 1000 : 0\n    const eventProperties: Record<string, any> = {\n      $ai_trace_id: traceId,\n      $ai_span_id: runId,\n      $ai_span_name: run.name,\n      $ai_parent_id: parentRunId,\n      $ai_provider: run.provider,\n      $ai_model: run.model,\n      $ai_model_parameters: run.modelParams,\n      $ai_input: withPrivacyMode(this.client, this.privacyMode, run.input),\n      $ai_http_status: 200,\n      $ai_latency: latency,\n      $ai_base_url: run.baseUrl,\n    }\n\n    if (output instanceof Error) {\n      eventProperties['$ai_http_status'] = (output as any).status || 500\n      eventProperties['$ai_error'] = output.toString()\n      eventProperties['$ai_is_error'] = true\n    } else {\n      // Handle token usage\n      const [inputTokens, outputTokens] = this.parseUsage(output)\n      eventProperties['$ai_input_tokens'] = inputTokens\n      eventProperties['$ai_output_tokens'] = outputTokens\n\n      // Handle generations/completions\n      let completions\n      if (output.generations && Array.isArray(output.generations)) {\n        const lastGeneration = output.generations[output.generations.length - 1]\n        if (Array.isArray(lastGeneration)) {\n          completions = lastGeneration.map((gen) => {\n            return { role: 'assistant', content: gen.text }\n          })\n        }\n      }\n\n      if (completions) {\n        eventProperties['$ai_output_choices'] = withPrivacyMode(this.client, this.privacyMode, completions)\n      }\n    }\n\n    Object.assign(eventProperties, this.properties)\n    if (!this.distinctId) {\n      eventProperties['$process_person_profile'] = false\n    }\n\n    this.client.capture({\n      distinctId: this.distinctId ? this.distinctId.toString() : traceId,\n      event: '$ai_generation',\n      properties: eventProperties,\n      groups: this.groups,\n    })\n  }\n\n  private _logDebugEvent(eventName: string, runId: string, parentRunId: string | undefined, extra: any): void {\n    if (this.debug) {\n      console.log(`Event: ${eventName}, runId: ${runId}, parentRunId: ${parentRunId}, extra:`, extra)\n    }\n  }\n\n  private _getLangchainRunName(serialized: any, ...args: any[]): string | undefined {\n    if (args && args.length > 0) {\n      for (const arg of args) {\n        if (arg && typeof arg === 'object' && 'name' in arg) {\n          return arg.name\n        }\n      }\n    }\n    if (serialized && serialized.name) {\n      return serialized.name\n    }\n    if (serialized && serialized.id) {\n      return Array.isArray(serialized.id) ? serialized.id[serialized.id.length - 1] : serialized.id\n    }\n    return undefined\n  }\n\n  private _convertMessageToDict(message: any): Record<string, any> {\n    let messageDict: Record<string, any> = {}\n\n    // Check the _getType() method or type property instead of instanceof\n    const messageType = message._getType?.() || message.type\n\n    switch (messageType) {\n      case 'human':\n        messageDict = { role: 'user', content: message.content }\n        break\n      case 'ai':\n        messageDict = { role: 'assistant', content: message.content }\n        break\n      case 'system':\n        messageDict = { role: 'system', content: message.content }\n        break\n      case 'tool':\n        messageDict = { role: 'tool', content: message.content }\n        break\n      case 'function':\n        messageDict = { role: 'function', content: message.content }\n        break\n      default:\n        messageDict = { role: messageType || 'unknown', content: String(message.content) }\n    }\n\n    if (message.additional_kwargs) {\n      messageDict = { ...messageDict, ...message.additional_kwargs }\n    }\n    return messageDict\n  }\n\n  private _parseUsageModel(usage: any): [number, number] {\n    const conversionList: Array<[string, 'input' | 'output']> = [\n      ['promptTokens', 'input'],\n      ['completionTokens', 'output'],\n      ['input_tokens', 'input'],\n      ['output_tokens', 'output'],\n      ['prompt_token_count', 'input'],\n      ['candidates_token_count', 'output'],\n      ['inputTokenCount', 'input'],\n      ['outputTokenCount', 'output'],\n      ['input_token_count', 'input'],\n      ['generated_token_count', 'output'],\n    ]\n\n    const parsedUsage = conversionList.reduce(\n      (acc: { input: number; output: number }, [modelKey, typeKey]) => {\n        const value = usage[modelKey]\n        if (value != null) {\n          const finalCount = Array.isArray(value)\n            ? value.reduce((sum: number, tokenCount: number) => sum + tokenCount, 0)\n            : value\n          acc[typeKey] = finalCount\n        }\n        return acc\n      },\n      { input: 0, output: 0 }\n    )\n\n    return [parsedUsage.input, parsedUsage.output]\n  }\n\n  private parseUsage(response: LLMResult): [number, number] {\n    let llmUsage: [number, number] = [0, 0]\n    const llmUsageKeys = ['token_usage', 'usage', 'tokenUsage']\n\n    if (response.llmOutput != null) {\n      const key = llmUsageKeys.find((k) => response.llmOutput?.[k] != null)\n      if (key) {\n        llmUsage = this._parseUsageModel(response.llmOutput[key])\n      }\n    }\n\n    // If top-level usage info was not found, try checking the generations.\n    if (llmUsage[0] === 0 && llmUsage[1] === 0 && response.generations) {\n      for (const generation of response.generations) {\n        for (const genChunk of generation) {\n          if (genChunk.generationInfo?.usage_metadata) {\n            llmUsage = this._parseUsageModel(genChunk.generationInfo.usage_metadata)\n            return llmUsage\n          }\n\n          const messageChunk = genChunk.generationInfo ?? {}\n          const responseMetadata = messageChunk.response_metadata ?? {}\n          const chunkUsage =\n            responseMetadata['usage'] ??\n            responseMetadata['amazon-bedrock-invocationMetrics'] ??\n            messageChunk.usage_metadata\n          if (chunkUsage) {\n            llmUsage = this._parseUsageModel(chunkUsage)\n            return llmUsage\n          }\n        }\n      }\n    }\n\n    return llmUsage\n  }\n}\n"],"names":["getModelParams","params","modelParams","paramKeys","key","undefined","formatResponseAnthropic","response","output","choice","content","text","push","role","formatResponseOpenAI","choices","message","mergeSystemPrompt","provider","messages","system","systemMessage","withPrivacyMode","client","privacyMode","input","privacy_mode","sendEventToPosthog","distinctId","traceId","model","latency","baseURL","httpStatus","usage","isError","error","capture","errorData","$ai_is_error","$ai_error","costOverrideData","posthogCostOverride","inputCostUSD","inputCost","inputTokens","outputCostUSD","outputCost","outputTokens","$ai_input_cost_usd","$ai_output_cost_usd","$ai_total_cost_usd","event","properties","$ai_provider","posthogProviderOverride","$ai_model","posthogModelOverride","$ai_model_parameters","$ai_input","posthogPrivacyMode","$ai_output_choices","$ai_http_status","$ai_input_tokens","$ai_output_tokens","$ai_latency","$ai_trace_id","$ai_base_url","posthogProperties","$process_person_profile","groups","posthogGroups","PostHogOpenAI","OpenAIOrignal","constructor","config","posthog","openAIConfig","phClient","chat","WrappedChat","Chat","parentClient","completions","WrappedCompletions","Completions","create","body","options","posthogDistinctId","posthogTraceId","openAIParams","uuidv4","startTime","Date","now","parentPromise","stream","then","value","stream1","stream2","tee","accumulatedContent","chunk","delta","prompt_tokens","completion_tokens","status","JSON","stringify","wrappedPromise","result","PostHogAzureOpenAI","AzureOpenAI","mapVercelParams","temperature","max_tokens","maxTokens","top_p","topP","frequency_penalty","frequencyPenalty","presence_penalty","presencePenalty","stop","stopSequences","mapVercelPrompt","prompt","map","p","Array","isArray","c","type","join","extractProvider","toLowerCase","providerName","split","createInstrumentationMiddleware","middleware","wrapGenerate","doGenerate","mergedParams","modelId","toolCalls","args","promptTokens","completionTokens","wrapStream","doStream","generatedText","rest","transformStream","TransformStream","transform","controller","textDelta","enqueue","flush","pipeThrough","wrapVercelLanguageModel","wrappedModel","wrapLanguageModel","PostHogAnthropic","AnthropicOriginal","anthropicConfig","WrappedMessages","Messages","anthropicParams","input_tokens","output_tokens","camelcaseModule","camelcase","snakeCase","LangChainCallbackHandler","BaseCallbackHandler","Error","name","runs","parentTree","debug","handleChainStart","chain","inputs","runId","parentRunId","tags","metadata","runType","runName","_logDebugEvent","_setParentOfRun","_setTraceOrSpanMetadata","handleChainEnd","outputs","kwargs","_popRunAndCaptureTraceOrSpan","handleChainError","handleChatModelStart","serialized","extraParams","flat","m","_convertMessageToDict","_setLLMMetadata","handleLLMStart","prompts","handleLLMEnd","_popRunAndCaptureGeneration","handleLLMError","err","handleToolStart","tool","handleToolEnd","handleToolError","handleRetrieverStart","retriever","query","handleRetrieverEnd","documents","handleRetrieverError","handleAgentAction","action","handleAgentEnd","_popParentOfRun","_findRootRun","id","defaultName","_getLangchainRunName","runNameFound","generation","invocation_params","ls_model_name","ls_provider","openai_api_base","baseUrl","_popRunMetadata","endTime","run","console","warn","_getTraceId","String","_getParentRunId","actualParentRunId","_captureTraceOrSpan","eventName","eventProperties","$ai_input_state","$ai_span_name","$ai_span_id","Object","assign","toString","_captureGeneration","$ai_parent_id","parseUsage","generations","lastGeneration","length","gen","extra","log","arg","messageDict","messageType","_getType","additional_kwargs","_parseUsageModel","conversionList","parsedUsage","reduce","acc","modelKey","typeKey","finalCount","sum","tokenCount","llmUsage","llmUsageKeys","llmOutput","find","k","genChunk","generationInfo","usage_metadata","messageChunk","responseMetadata","response_metadata","chunkUsage"],"mappings":"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"}